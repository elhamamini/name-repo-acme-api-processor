<html>
  <head> </head>
  <body>
    <script>
      //   const returnProduct = () => {
      //     return window
      //       .fetch("https://acme-users-api-rev.herokuapp.com/api/products")
      //       .then(data => data.json())
      //       .then(data => {
      //         data.filter(obj => {
      //           if (5 < obj.suggestedPrice < 15) {
      //             return obj;
      //           }
      //         });
      //       });
      //   };
      //   console.log(returnProduct());
      //   const groupedCompenisByLetter = () => {
      //     return window
      //       .fetch("https://acme-users-api-rev.herokuapp.com/api/companies")
      //       .then(data => data.json())
      //       .then(data => {
      //         data.reduce((accu, obj) => {
      //           let firstLetter = obj.name.slice(0, 1);
      //           if (accu[firstLetter] === undefined) {
      //             accu[firstLetter] = [obj.name];
      //           } else {
      //             accu[firstLetter].push(obj.name);
      //           }

      //           return accu;
      //         }, {});
      //       });
      //   };
      //   console.log(groupedCompenisByLetter());
      //   const groupedCompenisByState = () => {
      //     return window
      //       .fetch("https://acme-users-api-rev.herokuapp.com/api/companies")
      //       .then(data => data.json())
      //       .then(data => {
      //         data.reduce((accu, obj) => {
      //           if (accu[obj.state] === undefined) {
      //             accu[obj.state] = [obj.state];
      //           } else {
      //             accu[obj.state].push(obj.state);
      //           }

      //           return accu;
      //         }, {});
      //       });
      //   };
      //   console.log(groupedCompenisByState());
      //   const offerings = new Promise((res, rej) => {
      //     return window
      //       .fetch("https://acme-users-api-rev.herokuapp.com/api/offerings")
      //       .then(data => data.json())
      //       .then(data => {
      //         res(data);
      //         return data;
      //       });
      //   });
      //   console.log(offerings);
      //   const companies = fetch("https://acme-users-api-rev.herokuapp.com/api/companies")
      //       .then(response => response.json())
      //       .then(data => {
      //         // res(data);
      //         console.log(data);

      //   });
      //   console.log(companies);
      //   const nOrMoreOfferings = (companies, offerings, n) => {
      //     const objO = offerings.value.reduce((accu, obj) => {
      //       if (accu[obj.companyId] === undefined) {
      //         accu[obj.companyId] = 1;
      //       } else {
      //         accu[obj.companyId] += 1;
      //       }
      //       return accu;
      //     }, {});
      //     console.log(objO);
      //   };
      //   nOrMoreOfferings(companies, offerings, 3);
      const productsInPriceRange = (products, range) => {
        return products.filter(p => {
          if (range.min <= p.suggestedPrice && p.suggestedPrice <= range.max) {
            return true;
          } else {
            return false;
          }
        });
      };
      fetch("https://acme-users-api-rev.herokuapp.com/api/products")
        .then(response => response.json())
        .then(data => {
          console.log(productsInPriceRange(data, { min: 2, max: 10 }));
        });

      const groupedCompenisByLetter = companies => {
        return companies.reduce((accu, obj) => {
          let firstLetter = obj.name.slice(0, 1);
          if (accu[firstLetter] === undefined) {
            accu[firstLetter] = [obj.name];
          } else {
            accu[firstLetter].push(obj.name);
          }

          return accu;
        }, {});
      };
      fetch("https://acme-users-api-rev.herokuapp.com/api/companies")
        .then(response => response.json())
        .then(data => {
          console.log(groupedCompenisByLetter(data));
        });

      const groupedCompenisByState = companies => {
        return companies.reduce((accu, obj) => {
          if (accu[obj.state] === undefined) {
            accu[obj.state] = [obj];
          } else {
            accu[obj.state].push(obj);
          }

          return accu;
        }, {});
      };
      fetch("https://acme-users-api-rev.herokuapp.com/api/companies")
        .then(response => response.json())
        .then(data => {
          console.log(groupedCompenisByState(data));
        });

      const processedOfferings = ({ companies, products, offerings }) => {
        console.log(Object.keys(offerings));

        // offerings.reduce((accu, obj1) => {
        //   accu.push(obj1);
        //     console.log(obj);
        //     let obj = {};
        //     const company = myObj.companies.filter(obj2 => {
        //       if (obj1.companyId === obj2.id) {
        //         return true;
        //       } else {
        //         return false;
        //       }
        //     });

        //     obj[obj1] = [company];

        //     const product = myObj.products.filter(obj3 => {
        //       if (obj1.productId === obj3.id) {
        //         return true;
        //       } else {
        //         return false;
        //       }
        //     });
        //     obj[obj1].concat(product);
        //     accu.push(obj);
        //   return accu;
        // }, []);
      };

      const p1 = fetch(
        "https://acme-users-api-rev.herokuapp.com/api/companies"
      );
      const p2 = fetch("https://acme-users-api-rev.herokuapp.com/api/products");
      const p3 = fetch(
        "https://acme-users-api-rev.herokuapp.com/api/offerings"
      );
      Promise.all([p1, p2, p3])
        .then(responses => {
          return responses.map(p => {
            return p.json();
          });
        })
        .then(datas => {
          processedOfferings({
            companys: datas[0],
            products: datas[1],
            offerings: datas[2]
          });
        });

      const threeOrMoreOfferings = (companies, offerings, n) => {
        console.log(Array.isArray(companies));
        console.log(offerings);
        let arr = [];
        let myObj = offerings.reduce((accu, obj) => {
          if (accu[obj.companyId] === undefined) {
            accu[obj.companyId] = 1;
          } else {
            accu[obj.companyId] += 1;
          }
          return accu;
        }, {});
        Object.entries(myObj).forEach(([key, value]) => {
          if (value >= 3) {
            for (let i = 0; i < companies.length; i++) {
              if (companies[i].id === key) {
                arr.push(companies[i]);
              }
            }
          }
        });
        return arr;
      };

      Promise.all([
        fetch("https://acme-users-api-rev.herokuapp.com/api/offerings"),
        fetch("https://acme-users-api-rev.herokuapp.com/api/companies")
      ])
        .then(responses => {
          return responses.map(r => {
            return r.json();
          });
        })
        .then(datas => {
          console.log(Array.isArray(datas[0]));
          console.log(threeOrMoreOfferings(datas[0], datas[1], 3));
        });
    </script>
  </body>
</html>
